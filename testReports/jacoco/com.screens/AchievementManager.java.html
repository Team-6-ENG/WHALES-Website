<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AchievementManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tests</a> &gt; <a href="index.source.html" class="el_package">com.screens</a> &gt; <span class="el_source">AchievementManager.java</span></div><h1>AchievementManager.java</h1><pre class="source lang-java linenums">package com.screens;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.utils.Json;
import com.badlogic.gdx.utils.JsonWriter;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 * Manages the local achievements' functionality. Handles saving and loading achievements from a
 * local JSON file.
 *  [01/01/2026] - Added achievement manager for local storage
 */
public class AchievementManager {
  /** The file path for storing achievement data. */
  private static final String ACHIEVEMENTS_FILE = &quot;assets/achievements.json&quot;;

  /** JSON instance for serialization/deserialization. */
  private final Json json;

  /** Map of all available achievements by ID. */
  private final Map&lt;String, Achievement&gt; achievementsMap;

  /** Constructs a new AchievementManager. */
<span class="fc" id="L29">  public AchievementManager() {</span>
<span class="fc" id="L30">    this.json = new Json();</span>
<span class="fc" id="L31">    this.json.setOutputType(JsonWriter.OutputType.json);</span>
<span class="fc" id="L32">    this.achievementsMap = new HashMap&lt;&gt;();</span>
<span class="fc" id="L33">    initializeAchievements();</span>
<span class="fc" id="L34">    loadAchievements();</span>
<span class="fc" id="L35">  }</span>

  /** Initializes the list of all available achievements. */
  private void initializeAchievements() {
    // Speed Runner - Win in under 3 minutes (180 seconds)
<span class="fc" id="L40">    achievementsMap.put(</span>
        &quot;speed_runner&quot;,
        new Achievement(&quot;speed_runner&quot;, &quot;Speed Runner&quot;, &quot;Win the game in under 3 minutes&quot;));

    // Totally Lost - Reach the carpark
<span class="fc" id="L45">    achievementsMap.put(</span>
        &quot;totally_lost&quot;, new Achievement(&quot;totally_lost&quot;, &quot;Totally Lost&quot;, &quot;Reach the carpark&quot;));

    // Teacher's Pet - Listen to the professor for 15 seconds
<span class="fc" id="L49">    achievementsMap.put(</span>
        &quot;teachers_pet&quot;,
        new Achievement(&quot;teachers_pet&quot;, &quot;Teacher's Pet&quot;, &quot;Listen to the professor for 15 seconds&quot;));

    // Sugar Crash - Drink too many energy drinks
<span class="fc" id="L54">    achievementsMap.put(</span>
        &quot;sugar_crash&quot;,
        new Achievement(&quot;sugar_crash&quot;, &quot;Sugar Crash&quot;, &quot;Drink too many energy drinks&quot;));
<span class="fc" id="L57">  }</span>

  /**
   * Unlocks an achievement by ID.
   *
   * @param achievementId The ID of the achievement to unlock
   * @return The unlocked Achievement if it was just unlocked, null otherwise
   */
  public Achievement unlockAchievement(String achievementId) {
<span class="fc" id="L66">    Achievement achievement = achievementsMap.get(achievementId);</span>
<span class="pc bpc" id="L67" title="1 of 4 branches missed.">    if (achievement != null &amp;&amp; !achievement.unlocked) {</span>
<span class="fc" id="L68">      String currentDate = getCurrentDateString();</span>
<span class="fc" id="L69">      achievement.unlock(currentDate);</span>
<span class="fc" id="L70">      saveAchievements();</span>
<span class="fc" id="L71">      Gdx.app.log(&quot;AchievementManager&quot;, &quot;Unlocked achievement: &quot; + achievement.name);</span>
<span class="fc" id="L72">      return achievement;</span>
    }
<span class="fc" id="L74">    return null;</span>
  }

  /**
   * Checks if an achievement is unlocked.
   *
   * @param achievementId The ID of the achievement to check
   * @return true if the achievement is unlocked, false otherwise
   */
  public boolean isUnlocked(String achievementId) {
<span class="fc" id="L84">    Achievement achievement = achievementsMap.get(achievementId);</span>
<span class="pc bpc" id="L85" title="1 of 4 branches missed.">    return achievement != null &amp;&amp; achievement.unlocked;</span>
  }

  /**
   * Gets all achievements.
   *
   * @return A list of all achievements
   */
  public List&lt;Achievement&gt; getAllAchievements() {
<span class="fc" id="L94">    return new ArrayList&lt;&gt;(achievementsMap.values());</span>
  }

  /**
   * Gets a specific achievement by ID.
   *
   * @param achievementId The ID of the achievement
   * @return The achievement, or null if not found
   */
  public Achievement getAchievement(String achievementId) {
<span class="fc" id="L104">    return achievementsMap.get(achievementId);</span>
  }

  /** Resets all achievements to unlocked state Change [01/01/2026] - Added reset method. */
  public void resetAllAchievements() {
<span class="nc bnc" id="L109" title="All 2 branches missed.">    for (Achievement achievement : achievementsMap.values()) {</span>
<span class="nc" id="L110">      achievement.unlocked = false;</span>
<span class="nc" id="L111">      achievement.unlockedDate = null;</span>
<span class="nc" id="L112">    }</span>
<span class="nc" id="L113">    saveAchievements();</span>
<span class="nc" id="L114">    Gdx.app.log(&quot;AchievementManager&quot;, &quot;All achievements have been reset to unlocked state&quot;);</span>
<span class="nc" id="L115">  }</span>

  /** Saves the current achievements to local storage. */
  private void saveAchievements() {
    try {
<span class="fc" id="L120">      List&lt;Achievement&gt; achievementsList = new ArrayList&lt;&gt;(achievementsMap.values());</span>
<span class="fc" id="L121">      AchievementData data = new AchievementData(achievementsList);</span>
<span class="fc" id="L122">      json.setOutputType(JsonWriter.OutputType.json);</span>
<span class="fc" id="L123">      String jsonString = json.toJson(data);</span>
<span class="fc" id="L124">      Gdx.files.local(ACHIEVEMENTS_FILE).writeString(jsonString, false);</span>
<span class="fc" id="L125">      Gdx.app.log(&quot;AchievementManager&quot;, &quot;Saved &quot; + achievementsList.size() + &quot; achievements&quot;);</span>
<span class="nc" id="L126">    } catch (Exception e) {</span>
<span class="nc" id="L127">      Gdx.app.error(&quot;AchievementManager&quot;, &quot;Failed to save achievements&quot;, e);</span>
<span class="fc" id="L128">    }</span>
<span class="fc" id="L129">  }</span>

  /** Loads achievements from local storage. */
  private void loadAchievements() {
    try {
<span class="fc bfc" id="L134" title="All 2 branches covered.">      if (!Gdx.files.local(ACHIEVEMENTS_FILE).exists()) {</span>
<span class="fc" id="L135">        Gdx.app.log(&quot;AchievementManager&quot;, &quot;Achievements file does not exist, using defaults&quot;);</span>
<span class="fc" id="L136">        saveAchievements();</span>
<span class="fc" id="L137">        return;</span>
      }

<span class="fc" id="L140">      String fileContent = Gdx.files.local(ACHIEVEMENTS_FILE).readString();</span>
<span class="fc" id="L141">      AchievementData data = json.fromJson(AchievementData.class, fileContent);</span>

<span class="pc bpc" id="L143" title="1 of 2 branches missed.">      if (data == null) {</span>
<span class="nc" id="L144">        Gdx.app.error(</span>
            &quot;AchievementManager&quot;, &quot;Failed to deserialize achievement data - data is null&quot;);
<span class="nc" id="L146">        return;</span>
      }

<span class="pc bpc" id="L149" title="1 of 2 branches missed.">      if (data.achievements == null) {</span>
<span class="nc" id="L150">        Gdx.app.error(</span>
            &quot;AchievementManager&quot;,
            &quot;Failed to deserialize achievement data - achievements list is null&quot;);
<span class="nc" id="L153">        return;</span>
      }

<span class="fc bfc" id="L156" title="All 2 branches covered.">      for (Achievement loadedAchievement : data.achievements) {</span>
<span class="pc bpc" id="L157" title="2 of 4 branches missed.">        if (loadedAchievement != null &amp;&amp; loadedAchievement.id != null) {</span>
<span class="fc" id="L158">          Achievement defaultAchievement = achievementsMap.get(loadedAchievement.id);</span>
<span class="pc bpc" id="L159" title="1 of 2 branches missed.">          if (defaultAchievement != null) {</span>
<span class="fc" id="L160">            defaultAchievement.unlocked = loadedAchievement.unlocked;</span>
<span class="fc" id="L161">            defaultAchievement.unlockedDate = loadedAchievement.unlockedDate;</span>
          } else {
<span class="nc" id="L163">            achievementsMap.put(loadedAchievement.id, loadedAchievement);</span>
          }
        }
<span class="fc" id="L166">      }</span>

<span class="fc" id="L168">      int unlockedCount = 0;</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">      for (Achievement achievement : achievementsMap.values()) {</span>
<span class="fc bfc" id="L170" title="All 2 branches covered.">        if (achievement.unlocked) {</span>
<span class="fc" id="L171">          unlockedCount++;</span>
        }
<span class="fc" id="L173">      }</span>
<span class="fc" id="L174">      Gdx.app.log(</span>
          &quot;AchievementManager&quot;,
          &quot;Loaded &quot;
              + unlockedCount
              + &quot; unlocked achievements out of &quot;
<span class="fc" id="L179">              + achievementsMap.size()</span>
              + &quot; total&quot;);
<span class="nc" id="L181">    } catch (Exception e) {</span>
<span class="nc" id="L182">      Gdx.app.error(&quot;AchievementManager&quot;, &quot;Failed to load achievements: &quot; + e.getMessage(), e);</span>
<span class="fc" id="L183">    }</span>
<span class="fc" id="L184">  }</span>

  /**
   * Gets the current date as a formatted string.
   *
   * @return A string representing the current date and time in &quot;yyyy-MM-dd HH:mm:ss&quot; format
   */
  private String getCurrentDateString() {
<span class="fc" id="L192">    SimpleDateFormat dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span>
<span class="fc" id="L193">    return dateFormat.format(new Date());</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>